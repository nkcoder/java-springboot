# =============================================================================
# Base Configuration - Shared across all profiles
# =============================================================================
# Profile-specific configs override these values.
# Activate profiles via: --spring.profiles.active=local|dev|prod
# =============================================================================

server:
  port: 3001
  servlet:
    context-path: /
  shutdown: graceful

spring:
  application:
    name: user-service

  # Default: Docker Compose disabled (only enabled in 'local' profile)
  docker:
    compose:
      enabled: false

  # Virtual threads (Project Loom) - enabled for all environments
  threads:
    virtual:
      enabled: true

  # Flyway migrations
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: true
    validate-migration-naming: true

  # JPA/Hibernate defaults
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    open-in-view: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        use_sql_comments: true
        jdbc:
          batch_size: 20
          fetch_size: 100
        generate_statistics: false

  # gRPC configuration
  grpc:
    server:
      port: 9090
      max-inbound-message-size: 4MB
      max-inbound-metadata-size: 8KB
      reflection:
        enabled: true

# -----------------------------------------------------------------------------
# JWT Configuration
# -----------------------------------------------------------------------------
# IMPORTANT: Override secrets via environment variables in dev/prod!
# Default secrets are for local development only.
jwt:
  secret:
    access: ${JWT_ACCESS_SECRET:default-hmac512-access-secret-key-for-local-dev-only-not-for-production-64-bytes}
    refresh: ${JWT_REFRESH_SECRET:default-hmac512-refresh-secret-key-for-local-dev-only-not-for-prod-64-bytes}
  expiration:
    access: ${JWT_ACCESS_EXPIRES_IN:15m}
    refresh: ${JWT_REFRESH_EXPIRES_IN:7d}
  issuer: ${JWT_ISSUER:user-service}

# -----------------------------------------------------------------------------
# CORS Configuration
# -----------------------------------------------------------------------------
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000}
  allowed-methods: GET,POST,PUT,DELETE,PATCH,OPTIONS
  allowed-headers: "*"
  allow-credentials: true
  max-age: 3600

# -----------------------------------------------------------------------------
# Actuator Configuration
# -----------------------------------------------------------------------------
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
      probes:
        enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true
  info:
    env:
      enabled: true

# -----------------------------------------------------------------------------
# OpenAPI/Swagger Configuration (disabled by default, enabled in local/dev)
# -----------------------------------------------------------------------------
springdoc:
  api-docs:
    path: /api-docs
    enabled: false
  swagger-ui:
    path: /swagger-ui.html
    enabled: false
    tags-sorter: alpha
    operations-sorter: alpha
  show-actuator: false

# -----------------------------------------------------------------------------
# Logging Configuration (base level)
# -----------------------------------------------------------------------------
logging:
  level:
    root: INFO
    org.nkcoder: INFO
    org.springframework.security: WARN
    org.springframework.web: WARN
    org.hibernate.SQL: WARN
    org.hibernate.orm.jdbc.bind: WARN
    com.zaxxer.hikari: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# -----------------------------------------------------------------------------
# Application Information
# -----------------------------------------------------------------------------
info:
  app:
    name: '@project.name@'
    version: '@project.version@'
    description: '@project.description@'
    java-version: '@java.version@'
    spring-boot-version: '@parent.version@'
